<%- contentFor('HeaderCss') %>

<!-- DataTables -->
<link href="/public/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
<link href="/public/assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
<!-- Responsive datatable examples -->
<link href="/public/assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
<link href="/public/assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css">
<!-- C3 Chart css -->
<link href="/public/assets/libs/c3/c3.min.css" rel="stylesheet" type="text/css">

<%- contentFor('breadcrumb') %>
<!-- start page title -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-flex align-items-center justify-content-between">
      <h4 class="mb-0 font-size-18">Dashboard</h4>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><a href="javascript: void(0);">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </div>
    </div>
  </div>
</div>
<!-- end page title -->

<%- contentFor('body') %>
<div class="row">
  <div class="col-md-6 col-xl-3">
    <div class="card">
      <div class="card-body">
        <div class="mini-stat">
          <span class="mini-stat-icon bg-purple me-0 float-end"><i class="mdi mdi-basket"></i></span>
          <div class="mini-stat-info">
            <span class="counter text-purple" id="totalOrders"><%= totaldata.orders || 0 %></span>
            Total Orders
          </div>
          <p class="mb-0 mt-4 text-muted">
            Total income: $<span id="totalIncome">0</span>
            <span class="float-end"><i class="fa fa-caret-up me-1"></i>10.25%</span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card">
      <div class="card-body">
        <div class="mini-stat">
          <span class="mini-stat-icon bg-blue-grey me-0 float-end"><i class="mdi mdi-black-mesa"></i></span>
          <div class="mini-stat-info">
            <span class="counter text-blue-grey" id="totalProducts"><%= totaldata.products || 0 %></span>
            Total Products
          </div>
          <p class="text-muted mb-0 mt-4">
            Total stock: <span id="totalStock">0</span>
            <span class="float-end"><i class="fa fa-caret-up me-1"></i>5.15%</span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card">
      <div class="card-body">
        <div class="mini-stat">
          <span class="mini-stat-icon bg-brown me-0 float-end"><i class="mdi mdi-buffer"></i></span>
          <div class="mini-stat-info">
            <span class="counter text-brown" id="totalUsers"><%= totaldata.users || 0 %></span>
            Total Users
          </div>
          <p class="text-muted mb-0 mt-4">
            Active users: <span id="activeUsers">0</span>
            <span class="float-end"><i class="fa fa-caret-up me-1"></i>8.50%</span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card">
      <div class="card-body">
        <div class="mini-stat">
          <span class="mini-stat-icon bg-teal me-0 float-end"><i class="mdi mdi-coffee"></i></span>
          <div class="mini-stat-info">
            <span class="counter text-teal" id="totalShipments"><%= totaldata.shipments || 0 %></span>
            Total Shipments
          </div>
          <p class="text-muted mb-0 mt-4">
            Pending: <span id="pendingShipments">0</span>
            <span class="float-end"><i class="fa fa-caret-up me-1"></i>12.30%</span>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xl-6">
    <div class="row">
      <div class="col-md-12 monthly-earning-wid">
        <div class="card" style="height: 480px;">
          <div class="card-body">
            <h4 class="card-title">Order Statistics</h4>
            <div class="text-center">
              <div class="btn-group mt-4" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary" onclick="updateChart('day')">Day</button>
                <button type="button" class="btn btn-secondary" onclick="updateChart('month')">Month</button>
                <button type="button" class="btn btn-secondary" onclick="updateChart('year')">Year</button>
              </div>
            </div>
            <div id="combine-chart" dir="ltr" style=" min-height: 300px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-6">
    <div class="row">
      <div class="col-md-12 monthly-earning-wid">
        <div class="card" style="height: 480px;">
          <div class="card-body">
            <h4 class="card-title">Table Distribution</h4>
            <div class="text-center">
              <div class="btn-group mt-4" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary" onclick="updateDonutChart('day')">Day</button>
                <button type="button" class="btn btn-secondary" onclick="updateDonutChart('month')">Month</button>
                <button type="button" class="btn btn-secondary" onclick="updateDonutChart('year')">Year</button>
              </div>
            </div>
            <div id="donut-chart" dir="ltr" style=" min-height: 300px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- contentFor('FooterJs') %>
<!-- Peity chart -->
<script src="/public/assets/libs/peity/jquery.peity.min.js"></script>
<!-- C3 Chart -->
<script src="/public/assets/libs/d3/d3.min.js"></script>
<script src="/public/assets/libs/c3/c3.min.js"></script>
<script src="/public/assets/libs/jquery-knob/jquery.knob.min.js"></script>
<script src="/public/assets/libs/sweetalert2/sweetalert2.min.js"></script>
<script src="/public/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/public/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/public/assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="/public/assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
<script src="/public/assets/libs/jszip/jszip.min.js"></script>
<script src="/public/assets/libs/pdfmake/build/pdfmake.min.js"></script>
<script src="/public/assets/libs/pdfmake/build/vfs_fonts.js"></script>
<script src="/public/assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="/public/assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="/public/assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>
<script src="/public/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="/public/assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>

<script>
  console.log('combine-chart element:', document.getElementById('combine-chart'));
  console.log('donut-chart element:', document.getElementById('donut-chart'));
  console.log('totalData:', <%- JSON.stringify(totaldata) %>);

  const totalData = <%- JSON.stringify(totaldata) %>;

  function updateChart(period) {
    let orderData;
    const totalOrders = totalData.orders || 0;

    switch (period) {
      case 'day':
        orderData = [
          Math.round(totalOrders * 0.1),
          Math.round(totalOrders * 0.2),
          Math.round(totalOrders * 0.3),
          Math.round(totalOrders * 0.2),
          Math.round(totalOrders * 0.2)
        ];
        break;
      case 'month':
        orderData = [
          Math.round(totalOrders * 0.15),
          Math.round(totalOrders * 0.25),
          Math.round(totalOrders * 0.3),
          Math.round(totalOrders * 0.2),
          Math.round(totalOrders * 0.1)
        ];
        break;
      case 'year':
        orderData = [
          Math.round(totalOrders * 0.1),
          Math.round(totalOrders * 0.2),
          Math.round(totalOrders * 0.3),
          Math.round(totalOrders * 0.25),
          Math.round(totalOrders * 0.15)
        ];
        break;
      default:
        console.error('Invalid period:', period);
        return;
    }

    try {
      var combineChart = c3.generate({
        bindto: '#combine-chart',
        data: {
          columns: [['Orders', ...orderData]],
          types: {
            Orders: 'bar'
          }
        },
        axis: {
          x: {
            type: 'category',
            categories:
              period === 'day'
                ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']
                : period === 'month'
                ? ['Jan', 'Feb', 'Mar', 'Apr', 'May']
                : ['2020', '2021', '2022', '2023', '2024']
          }
        }
      });
    } catch (error) {
      console.error('Error rendering combine chart:', error);
    }
  }

  function updateDonutChart(period) {
    let columns;
    switch (period) {
      case 'day':
        columns = [
          ['Orders', Math.round((totalData.orders || 0) * 0.5)],
          ['Products', Math.round((totalData.products || 0) * 0.5)],
          ['Users', Math.round((totalData.users || 0) * 0.5)],
          ['Shipments', Math.round((totalData.shipments || 0) * 0.5)]
        ];
        break;
      case 'month':
        columns = [
          ['Orders', totalData.orders || 0],
          ['Products', totalData.products || 0],
          ['Users', totalData.users || 0],
          ['Shipments', totalData.shipments || 0]
        ];
        break;
      case 'year':
        columns = [
          ['Orders', Math.round((totalData.orders || 0) * 1.2)],
          ['Products', Math.round((totalData.products || 0) * 1.2)],
          ['Users', Math.round((totalData.users || 0) * 1.2)],
          ['Shipments', Math.round((totalData.shipments || 0) * 1.2)]
        ];
        break;
      default:
        console.error('Invalid period:', period);
        return;
    }

    try {
      var donutChart = c3.generate({
        bindto: '#donut-chart',
        data: {
          columns: columns,
          type: 'donut'
        },
        donut: {
          title: `Table Counts (${period})`
        }
      });
    } catch (error) {
      console.error('Error rendering donut chart:', error);
    }
  }

  // Initial chart loads
  updateChart('month');
  updateDonutChart('month');

  // Update mini-stats
  document.getElementById('totalIncome').innerText = totalData.totalIncome || 0;
  document.getElementById('totalStock').innerText = totalData.totalStock || 0;
  document.getElementById('activeUsers').innerText = totalData.activeUsers || 0;
  document.getElementById('pendingShipments').innerText = totalData.pendingShipments || 0;
</script>

<%- contentFor('BottomJs') %>